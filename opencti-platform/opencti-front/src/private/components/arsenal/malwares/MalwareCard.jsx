import React, { Component } from 'react';
import * as PropTypes from 'prop-types';
import { compose } from 'ramda';
import { createFragmentContainer, graphql } from 'react-relay';
import { GenericAttackCard } from '../../common/cards/GenericAttackCard';

class MalwareCardComponent extends Component {
  render() {
    const { node, bookmarksIds, onLabelClick } = this.props;
    return (
      <GenericAttackCard
        cardData={node}
        cardLink={`/dashboard/arsenal/malwares/${node.id}`}
        entityType="Malware"
        onLabelClick={onLabelClick}
        bookmarksIds={bookmarksIds}
      />
    );
  }
}

MalwareCardComponent.propTypes = {
  node: PropTypes.object,
  bookmarksIds: PropTypes.array,
  onLabelClick: PropTypes.func,
};

const MalwareCardFragment = createFragmentContainer(MalwareCardComponent, {
  node: graphql`
    fragment MalwareCard_node on Malware {
      id
      name
      aliases
      description
      created
      modified
      objectMarking {
        edges {
          node {
            id
            definition_type
            definition
            x_opencti_order
            x_opencti_color
          }
        }
      }
      objectLabel {
        edges {
          node {
            id
            value
            color
          }
        }
      }
      targetedCountries: stixCoreRelationships(
        relationship_type: "targets"
        toTypes: ["Country"]
        first: 5
        orderBy: created_at
        orderMode: desc
      ) {
        edges {
          node {
            to {
              ... on Country {
                name
              }
            }
          }
        }
      }
      targetedSectors: stixCoreRelationships(
        relationship_type: "targets"
        toTypes: ["Sector"]
        first: 5
        orderBy: created_at
        orderMode: desc
      ) {
        edges {
          node {
            to {
              ... on Sector {
                name
              }
            }
          }
        }
      }
      relatedIntrusionSets: stixCoreRelationships(
        relationship_type: "uses"
        fromTypes: ["Intrusion-Set"]
        first: 5
        orderBy: created_at
        orderMode: desc
      ) {
        edges {
          node {
            from {
              ... on IntrusionSet {
                name
              }
            }
          }
        }
      }
    }
  `,
});

const MalwareCard = compose()(MalwareCardFragment);
export default MalwareCard;
