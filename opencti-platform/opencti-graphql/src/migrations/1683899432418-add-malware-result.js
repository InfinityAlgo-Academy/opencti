import { executionContext, SYSTEM_USER } from '../utils/access';
import { VocabularyCategory } from '../generated/graphql';
import { builtInOv, openVocabularies } from '../modules/vocabulary/vocabulary-utils';
import { addVocabulary } from '../modules/vocabulary/vocabulary-domain';

export const up = async (next) => {
  const context = executionContext('migration');
  const category = VocabularyCategory.MalwareResultOv;
  const vocabularies = openVocabularies[category] ?? [];
  for (let i = 0; i < vocabularies.length; i += 1) {
    const { key, description } = vocabularies[i];
    const data = { name: key,
      description: description ?? '',
      category,
      builtIn: builtInOv.includes(category) };
    await addVocabulary(context, SYSTEM_USER, data);
  }
  next();
};

export const down = async (next) => {
  next();
};
